// Copyright {{year}} teamlint.com. All rights reserved.
// Code generated by ardan.

package jwt

import (
	"time"

	jwtlib "github.com/dgrijalva/jwt-go"
	"github.com/teamlint/ardan/config"
)

// NewToken 生成JWT Token
func NewToken(userID string) *jwtlib.Token {

	token := jwtlib.New(jwtlib.GetSigningMethod(config.Get("JWT", "Method").String("HS256")))
	// claims
	claims := jwtlib.MapClaims{
		"id": userID,
	}
	exp := config.Get("JWT", "Exp").String("72h")
	dur, err := time.ParseDuration(exp)
	if err == nil {
		claims["exp"] = time.Now().Add(dur).Unix()
	}
	token.Claims = claims
	return token
}

// SignedString 获取Token签名字符串
func SignedString(token *jwtlib.Token) string {
	tokenString, err := token.SignedString([]byte(config.Get("JWT", "Secret").String("")))
	if err != nil {
		return ""
	}
	return tokenString
}

// Secret 获取加密字符串
func Secret(token *jwtlib.Token) (interface{}, error) {
	secret := config.Get("JWT", "Secret").String("")
	b := ([]byte(secret))
	return b, nil
}
